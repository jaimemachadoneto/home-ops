---
# HTTPRoute to accept the OAuth2 callback at the external-auth gateway
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: envoy-ext-auth-callback
  namespace: network
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/description: Envoy external auth callback route
spec:
  hostnames:
    - envoy-ext-auth.${SECRET_DOMAIN}
  parentRefs:
    - name: envoy-external-auth
      namespace: network
      sectionName: https
  rules:
    - matches:
        - path:
            type: Exact
            value: /oauth2/callback
      backendRefs:
        - name: echo-server
          namespace: network
          port: 80
